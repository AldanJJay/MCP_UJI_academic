# MCP UJI Academic Server

Servidor MCP (Model Context Protocol) HTTP que proporciona acceso a la informaci√≥n acad√©mica de la Universitat Jaume I (UJI). Optimizado para acceso remoto a trav√©s de HTTP con compatibilidad completa con MCP Inspector.

## ‚ú® Caracter√≠sticas Principales

- üéì **Acceso Completo a Datos Acad√©micos**: Asignaturas, titulaciones, horarios y ubicaciones
- üåê **Soporte Multiidioma**: Contenido en catal√°n, espa√±ol e ingl√©s  
- üåç **HTTP Puro**: Servidor HTTP op### Error de conexi√≥n HTTP

- Verifica que el servidor remoto est√© ejecut√°ndose
- Comprueba la URL HTTP en la configuraci√≥n (`http://IP:8084/mcp`)
- Revisa los logs del servidor para errores
- Confirma que el puerto 8084 est√© abiertoado para acceso remoto y compatibilidad m√°xima
- ‚ö° **Cache Inteligente**: Sistema de cach√© integrado para mejor rendimiento
- üîç **Funcionalidad de B√∫squeda**: B√∫squeda avanzada en asignaturas, titulaciones y ubicaciones
- üìÖ **Gesti√≥n de Horarios**: An√°lisis y gesti√≥n de horarios en formato iCalendar
- üõ°Ô∏è **Manejo Robusto de Errores**: Gesti√≥n de errores con mensajes descriptivos
- üîí **Seguridad de Tipos**: Type hints completos y modelos Pydantic para validaci√≥n
- üîß **Compatible con MCP Inspector**: Funciona perfectamente con herramientas de desarrollo MCP

## üîß Instalaci√≥n

### Prerrequisitos

- Python 3.12 o superior
- Gestor de paquetes UV

### Configuraci√≥n

1. **Clona el repositorio**:

   ```bash
   git clone <repository-url>
   cd MCP_UJI_academic
   ```

2. **Instala las dependencias con UV**:

   ```bash
   uv sync
   ```

## ‚öôÔ∏è Configuraci√≥n de Clientes MCP

> **üì° Servidor Remoto**: El servidor MCP se ejecuta en una m√°quina remota (ej: `150.128.81.57:8084`), no en tu m√°quina local. Las configuraciones est√°n optimizadas para este escenario.

### ü§î ¬øNPX para Claude Desktop o VS Code?

**‚ùå NO**: `npx @modelcontextprotocol/inspector` es **SOLO** una herramienta de testing y desarrollo, no conecta Claude Desktop o VS Code al servidor.

**‚úÖ S√ç**: Claude Desktop y VS Code necesitan sus propias configuraciones espec√≠ficas (JSON) para conectarse al servidor MCP.

**Diferencias:**

| Cliente | M√©todo de Conexi√≥n | Configuraci√≥n |
|---------|-------------------|---------------|
| **MCP Inspector** | `npx` (temporal) | Interface web para testing |
| **Claude Desktop** | JSON config | Archivo `claude_desktop_config.json` |
| **VS Code** | JSON config | Settings de extensi√≥n MCP |

### Claude Desktop

Para usar el servidor remoto con Claude Desktop, agrega la siguiente configuraci√≥n a tu archivo `claude_desktop_config.json`:

**Ubicaci√≥n del archivo de configuraci√≥n:**

- **Windows**: `%APPDATA%\Claude\claude_desktop_config.json`
- **macOS**: `~/Library/Application Support/Claude/claude_desktop_config.json`
- **Linux**: `~/.config/claude/claude_desktop_config.json`

**üìã C√≥mo conectar Claude Desktop al servidor MCP:**

> **‚ö†Ô∏è Limitaci√≥n**: Claude Desktop **NO puede conectarse directamente** a servidores HTTP remotos. Solo ejecuta comandos locales.

#### Opci√≥n A: T√∫nel SSH + Comando Local (Recomendado)

```json
{
  "mcpServers": {
    "mcp-uji-academic": {
      "command": "bash",
      "args": [
        "-c",
        "ssh -L 8084:localhost:8084 usuario@150.128.81.57 -N & sleep 3 && curl -s http://127.0.0.1:8084/mcp -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"ping\"}' > /dev/null && exec python3 -c \"import json,urllib.request; exec(open('/dev/stdin').read())\""
      ]
    }
  }
}
```

#### Opci√≥n B: Copia Local Completa (M√°s Simple)

```json
{
  "mcpServers": {
    "mcp-uji-academic": {
      "command": "uv",
      "args": ["run", "start_server.py", "--host", "127.0.0.1", "--port", "8084"],
      "cwd": "/ruta/local/completa/al/proyecto/MCP_UJI_academic"
    }
  }
}
```

#### Opci√≥n C: Proxy HTTP Local (Avanzado)

Si tienes un proxy HTTP local que redirija a tu servidor remoto:

```json
{
  "mcpServers": {
    "mcp-uji-academic": {
      "command": "python3",
      "args": ["-m", "http.server", "--bind", "127.0.0.1", "8084"],
      "env": {
        "PROXY_TARGET": "http://150.128.81.57:8084"
      }
    }
  }
}
```

> **‚ö†Ô∏è Importante**: 
> - Cambia `IP_SERVIDOR_REMOTO` por la IP real del servidor
> - Cambia `usuario` por tu usuario en el servidor remoto
> - Aseg√∫rate de tener acceso SSH al servidor remoto

### Visual Studio Code

Para usar el servidor remoto con VS Code y extensiones MCP:

#### Servidor HTTP Remoto (Recomendado)

```json
{
  "mcp.servers": {
    "mcp-uji-academic": {
      "transport": "http",
      "url": "http://IP_SERVIDOR_REMOTO:8084/mcp"
    }
  }
}
```

> **‚ö†Ô∏è Importante**: Cambia `IP_SERVIDOR_REMOTO` por la IP real del servidor (ej: `150.128.81.57`)

#### T√∫nel SSH (Alternativo)

Si prefieres usar un t√∫nel SSH:

1. **Establece el t√∫nel:**
   ```bash
   ssh -L 8084:localhost:8084 usuario@IP_SERVIDOR_REMOTO
   ```

2. **Configuraci√≥n VS Code:**
   ```json
   {
     "mcp.servers": {
       "mcp-uji-academic": {
         "transport": "http",
         "url": "http://127.0.0.1:8084/mcp"
       }
     }
   }
   ```

### Otras Aplicaciones MCP

Para cualquier cliente MCP que soporte HTTP, conecta al servidor remoto:

- **Endpoint MCP Remoto**: `http://IP_SERVIDOR_REMOTO:8084/mcp`
- **Endpoint Desarrollo**: `http://150.128.81.57:8084/mcp`
- **M√©todo**: `POST`
- **Headers**: `Content-Type: application/json`
- **Protocolo**: JSON-RPC 2.0

**Ejemplo de configuraci√≥n gen√©rica:**

```json
{
  "servers": {
    "uji-academic": {
      "transport": "http",
      "endpoint": "http://150.128.81.57:8084/mcp",
      "timeout": 30000
    }
  }
}
```

### üìã Resumen: NPX vs Configuraci√≥n de Clientes

**Para aclarar la confusi√≥n:**

| Herramienta | ¬øUsa NPX? | Prop√≥sito | Configuraci√≥n |
|-------------|-----------|-----------|---------------|
| **MCP Inspector** | ‚úÖ `npx @modelcontextprotocol/inspector` | Testing y desarrollo | Interface web temporal |
| **Claude Desktop** | ‚ùå NO usa NPX | Cliente productivo | JSON en archivo config |
| **VS Code** | ‚ùå NO usa NPX | Cliente productivo | JSON en settings |

**Respuesta directa:**
- **NPX**: Solo para testing con MCP Inspector
- **Claude Desktop**: Requiere configuraci√≥n JSON (no NPX)  
- **VS Code**: Requiere configuraci√≥n JSON (no NPX)
- **Servidor MCP**: Se conecta a TODOS mediante HTTP, pero cada cliente tiene su propio m√©todo

## üöÄ Uso del Servidor

### Servidor HTTP MCP

```bash
# Servidor en localhost (desarrollo)
uv run start_server.py --host 127.0.0.1 --port 8084

# Servidor accesible desde la red
uv run start_server.py --host 0.0.0.0 --port 8084

# Con auto-reload para desarrollo
uv run start_server.py --host 127.0.0.1 --port 8084 --reload

# Usando Python directamente (alternativo)
python start_server.py --host 0.0.0.0 --port 8084
```

> **üí° Nota**: El servidor es HTTP por defecto. Para acceso desde la red, usa `--host 0.0.0.0`.

## ÔøΩ Integraci√≥n y Testing

### ¬øCu√°ndo conectar con NPX?

**MCP Inspector con `npx` es ideal para:**

üîß **Desarrollo y Testing**
- Validar que el servidor remoto est√° funcionando
- Probar nuevas funcionalidades sin configurar clientes
- Debug de problemas de conectividad

üöÄ **Exploraci√≥n R√°pida**
- Ver todas las herramientas disponibles (8 herramientas UJI)
- Ejecutar llamadas MCP interactivamente
- Entender la estructura de respuestas JSON

‚ö° **Sin Instalaci√≥n**
- No requiere configuraci√≥n compleja de clientes
- Funciona desde cualquier m√°quina con Node.js
- Ideal para demos y presentaciones

### MCP Inspector (Recomendado)

Para probar y explorar el servidor de forma interactiva usando `npx`:

#### Cu√°ndo usar MCP Inspector con npx:

- ‚úÖ **Siempre disponible**: No requiere instalaci√≥n local
- ‚úÖ **Testing r√°pido**: Ideal para pruebas y desarrollo
- ‚úÖ **Exploraci√≥n interactiva**: Ver todas las herramientas y probar llamadas
- ‚úÖ **Validaci√≥n de endpoints**: Confirmar que el servidor remoto funciona

#### Conexi√≥n al Servidor Remoto:

1. **Ejecuta MCP Inspector**:
   ```bash
   npx @modelcontextprotocol/inspector
   ```

2. **Configura la conexi√≥n en la interfaz web**:
   - **Transport**: `Streamable HTTP`
   - **URL**: `http://150.128.81.57:8084/mcp`
   - **Method**: `POST`

3. **Conecta y explora**:
   - El inspector se abrir√° en tu navegador (normalmente `http://localhost:3000`)
   - Podr√°s ver las 8 herramientas disponibles
   - Probar llamadas MCP en tiempo real

#### Conexi√≥n con T√∫nel SSH (Alternativo):

Si prefieres usar un t√∫nel SSH:

1. **Establece el t√∫nel**:
   ```bash
   ssh -L 8084:localhost:8084 usuario@150.128.81.57
   ```

2. **Ejecuta MCP Inspector**:
   ```bash
   npx @modelcontextprotocol/inspector
   ```

3. **Configura con URL local**:
   - **URL**: `http://localhost:8084/mcp`
   - **Transport**: `Streamable HTTP`
   - **Method**: `POST`

> **üöÄ Tip**: MCP Inspector es la forma m√°s r√°pida de validar que tu servidor remoto est√° funcionando correctamente y explorar todas las herramientas disponibles.

### Ejemplo Pr√°ctico: Conexi√≥n con NPX

**Escenario 1: Conexi√≥n Directa al Servidor Remoto**

```bash
# 1. Ejecuta MCP Inspector
npx @modelcontextprotocol/inspector

# 2. Abre el navegador en http://localhost:3000
# 3. Configura la conexi√≥n:
#    - Transport: Streamable HTTP
#    - URL: http://150.128.81.57:8084/mcp
#    - Method: POST
# 4. Haz clic en "Connect"
# 5. Explora las 8 herramientas UJI disponibles
```

**Escenario 2: Verificaci√≥n R√°pida de Servidor**

```bash
# Antes de conectar clientes, verifica que el servidor responde:
curl http://150.128.81.57:8084/health

# Si responde {"status": "ok"}, entonces puedes usar:
npx @modelcontextprotocol/inspector
# Y conectar a http://150.128.81.57:8084/mcp
```

**Escenario 3: Desarrollo Local con T√∫nel**

```bash
# Terminal 1: Establece t√∫nel SSH
ssh -L 8084:localhost:8084 usuario@150.128.81.57

# Terminal 2: Ejecuta inspector
npx @modelcontextprotocol/inspector
# Conecta a http://localhost:8084/mcp
```

### Test Manual con curl

```bash
# Verificar servidor activo
curl -X GET http://localhost:8084/health

# Listar herramientas disponibles
curl -X GET http://localhost:8084/tools

# Test de ping MCP
curl -X POST http://localhost:8084/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc": "2.0", "id": 1, "method": "ping"}'

# Listar herramientas MCP
curl -X POST http://localhost:8084/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc": "2.0", "id": 1, "method": "tools/list"}'
```

## üåê Endpoints del Servidor HTTP

### Desarrollo Local (localhost)

- üè† **Informaci√≥n del servidor**: `GET http://localhost:8084/`  
- üíì **Health check**: `GET http://localhost:8084/health`
- üõ†Ô∏è **Lista de herramientas**: `GET http://localhost:8084/tools`
- üîå **Endpoint MCP**: `POST http://localhost:8084/mcp`

### Servidor de Producci√≥n

- üè† **Informaci√≥n del servidor**: `GET http://150.128.81.57:8084/`  
- üíì **Health check**: `GET http://150.128.81.57:8084/health`
- üõ†Ô∏è **Lista de herramientas**: `GET http://150.128.81.57:8084/tools`
- üîå **Endpoint MCP**: `POST http://150.128.81.57:8084/mcp`

## ÔøΩÔ∏è Herramientas MCP Disponibles (8 herramientas)

El servidor HTTP MCP proporciona herramientas optimizadas para acceso acad√©mico UJI:

### üìö Asignaturas (2 herramientas)

- **`get_subjects`**: Lista paginada con filtros y soporte multiidioma
- **`search_subjects`**: B√∫squeda inteligente por nombre o c√≥digo

### üéì Titulaciones (2 herramientas)

- **`get_degrees`**: Cat√°logo completo de grados y m√°steres
- **`search_degrees`**: B√∫squeda de titulaciones por nombre

### üè¢ Ubicaciones (2 herramientas)

- **`get_locations`**: Directorio de edificios, aulas y laboratorios
- **`search_locations`**: B√∫squeda de espacios universitarios

### üìÖ Horarios (2 herramientas)

- **`get_class_schedule`**: Calendarios de clases por titulaci√≥n/a√±o
- **`get_exam_schedule`**: Calendarios de ex√°menes por titulaci√≥n/a√±o

> **üåê Todas las herramientas**: Soporte CA/ES/EN y respuestas JSON estructuradas

## üìö Recursos MCP

- **`uji://api/info`**: Informaci√≥n sobre la API y endpoints disponibles

## üß™ Desarrollo y Testing

### Tests de Integraci√≥n

```bash
# Test completo del sistema
uv run python integration_test.py

# Test espec√≠fico de herramientas HTTP
# (test_websocket.py fue eliminado tras simplificaci√≥n)
```

### Desarrollo con Auto-reload

```bash
# Servidor con recarga autom√°tica
uv run start_server.py --host 127.0.0.1 --port 8084 --reload
```

### Verificaci√≥n R√°pida

```bash
# Verificar servidor activo
curl http://localhost:8084/health

# Test de conectividad MCP
curl -X POST http://localhost:8084/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc": "2.0", "id": 1, "method": "ping"}'
```

### Verificar Servidor Remoto

**Desarrollo local:**

```bash
# Health check
curl http://localhost:8084/health

# Lista de herramientas disponibles  
curl http://localhost:8084/tools
```

**Servidor de prueba:**

```bash
# Health check
curl http://150.128.81.57:8084/health

# Lista de herramientas disponibles  
curl http://150.128.81.57:8084/tools
```

## üîó API Externa Utilizada

Este servidor utiliza la API REST oficial de UJI:

- **Base URL**: https://ujiapps.uji.es/lod-autorest/api/
- **Datasets**: asignaturas, titulaciones, ubicaciones, horarios
- **Formatos**: JSON, iCalendar (para horarios)

## üìÅ Estructura del Proyecto

```
MCP_UJI_academic/
‚îú‚îÄ‚îÄ mcp_server.py          # Servidor HTTP MCP principal
‚îú‚îÄ‚îÄ start_server.py        # Launcher del servidor HTTP
‚îú‚îÄ‚îÄ api_client.py          # Cliente API de UJI
‚îú‚îÄ‚îÄ models.py              # Modelos Pydantic
‚îú‚îÄ‚îÄ integration_test.py    # Tests de integraci√≥n
‚îú‚îÄ‚îÄ pyproject.toml         # Configuraci√≥n del proyecto
‚îî‚îÄ‚îÄ README.md              # Esta documentaci√≥n
```

## üîß Soluci√≥n de Problemas

### Error "Port already in use"

```bash
# Verificar qu√© proceso usa el puerto
lsof -i :8084

# Usar otro puerto
uv run start_server.py --port 8001
```

### Error de conexi√≥n WebSocket

- Verifica que el servidor remoto est√© ejecut√°ndose
- Comprueba la URL del WebSocket en la configuraci√≥n
- Revisa los logs del servidor para errores

### Conexi√≥n al servidor de prueba (150.128.81.57)

Si no puedes conectarte al servidor de prueba:

```bash
# Verificar conectividad de red
ping 150.128.81.57

# Verificar que el puerto 8084 est√© accesible
telnet 150.128.81.57 8084
# o con nc:
nc -zv 150.128.81.57 8084
```

**Configuraci√≥n de firewall** (en el servidor de prueba):

```bash
# Permitir tr√°fico en puerto 8084
sudo ufw allow 8084/tcp

# Verificar estado del firewall
sudo ufw status
```

### Problemas con uv

```bash
# Reinstalar dependencias
uv sync --reinstall
```

## üö¶ Estado del Proyecto

- ‚úÖ Servidor HTTP MCP funcional
- ‚úÖ Compatible con MCP Inspector  
- ‚úÖ 8 herramientas MCP implementadas
- ‚úÖ Tests de integraci√≥n completos
- ‚úÖ Documentaci√≥n completa
- ‚úÖ Ejemplos de configuraci√≥n

## üìÑ Licencia

MIT License

## ü§ù Contribuciones

Las contribuciones son bienvenidas. Por favor:

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üìû Soporte

Si encuentras alg√∫n problema o tienes preguntas:

1. Revisa la secci√≥n de soluci√≥n de problemas
2. Ejecuta los tests de integraci√≥n
3. Prueba con MCP Inspector
4. Crea un issue en el repositorio
